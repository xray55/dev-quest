services:
  devquest_generator:
    build: .
    container_name: devquest_generator
    restart: always
    # --- THE BRIDGE ---
    # This maps your Windows folder to the Container.
    # When Docker saves to 'academy.db', it appears on your Windows machine instantly.
    volumes:
      - .:/app
    # ------------------
    ports:
      - "8000:8000"
    environment:
      - OLLAMA_HOST=http://host.docker.internal:11434
    # Allows Docker to see your Localhost Ollama
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - career_network

  # (Optional) Interactive Terminal
  wetty_terminal:
    image: wettyoss/wetty
    container_name: wetty_terminal
    restart: always
    ports:
      - "3000:3000"
    environment:
      - WETTY_COMMAND=ssh -o StrictHostKeyChecking=no root@lab_target
    depends_on:
      - lab_target
    networks:
      - career_network

  # (Optional) Lab Target
  lab_target:
    image: ubuntu:22.04
    container_name: lab_target
    restart: always
    tty: true
    stdin_open: true
    command: >
      sh -c "apt-get update && apt-get install -y openssh-server python3 &&
             mkdir -p /var/run/sshd &&
             echo 'root:root' | chpasswd &&
             sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config &&
             /usr/sbin/sshd -D"
    networks:
      - career_network

networks:
  career_network:
    driver: bridge